\chapter{Systematic uncertainties}\label{sec:syst}

In this section the systematic uncertainties considered for this analysis are discussed.
Some of the systematics are handled in similar methods as those discussed in the previous CMS analysis~\cite{Khachatryan:2015isa,AN-14-129}.

The sources of systematic uncertainties investigated are:
\begin{description}
\item[limited amount of simulated events:] the propagation of the statistical uncertainty of the MC sample used to compute the efficiency;
  %% the efficiency is computed using a finite set of simulated events; the size of this sample affects the accuracy of the determination of the efficiency;

\item[simulation mismodelling:] the effect of eventual mis-modelling in the simulated angular shape;
  %% the results from the fitting on the generated pure signal events are used to estimate simulation mis-modelling;

\item[efficiency shape:] the effect of mis-modelling in the efficiency functions, computed using the control channels;

\item[fitting bias:] the possible biases from the fitting procedures, evaluated on data-like ``cocktail'' MC samples;

\item[wrong CP assignment:] the effect of wrong CP assignment on fit results;

\item[background distributions:] the effects of the background \pdf uncertainties, due to finite sideband statistics, on the fit results;

\item[uncertainty from fixed \pdf parameters:] the propagation of the uncertainties on the angular parameters $F_L$, $A_S$, $F_S$;

\item[angular resolution:] the effect of the finite reconstruction resolution on the fit results;
  
\item[feed-through background:] the effect of the contamination with $B^0 \to {\rm J}\psi K^{*0}$ and $B^0 \to \psi' K^{*0}$ feed-through events, in $q^2$ bins just below and above the resonance regions;

\item[bivariate gauss fit range:] the dependency of the results on the range of the bivariate fit to the likelihood distribution in the $P_1$, $P'_5$ plane, when estimating the best-fit value.

\end{description}

In the following sections, the systematic uncertainties sources are discussed and estimated.

\section{Limited amount of simulated events}
\label{sec:sys-lim.MCstat}

The use of kernel density estimator to determine the numerator and denominator of the efficiency is based on a sample of simulated events, and a systematic uncertainty is expected from the limited size of the sample used.
The unbinned approach prevents the use of a simple binomial error estimation to be propagated to the parameterisation itself.
%% Instead, two different method have been used to estimate this uncertainty.

%% In the first one, the original sample is subdivided in four subsamples, and
%% each one is used independently to estimate the efficiency using the KDE method,
%% obtaining four efficiencies, which are used to perform the \pdf fit. The spread
%% of the fitting parameters resulting from these four fittings, divided by $\sqrt{4}$,
%% are used as systematic uncertainty related to the limited size of simulated sample.

The method used to evaluate this systematic contribution makes use of a set of 101 efficiency function based on pseudo-experiments.
For each efficiency, we generate pseudo-experiment datasets for numerator and denominator terms of the efficiency, with the same number of events as the original samples, based on the \pdf returned by the KDE description of numerator and denominator, respectively.
These additional datasets are then used to compute efficiency using the same KDE approach used in the original sample.
Finally, 101 fits are performed using each of the new efficiency functions.
The spread of the fit result distributions obtained by these fits is used as systematic uncertainty.

This method is first tested on a cocktail-MC sample, as the ones used for the validation of the fit described in Section~\ref{sec:Cocktail-MC-pure}.
The results of the fits with the toy-efficiencies are compared to the result of the fit with the original efficiency, computed both on the same cocktail-MC sample and on the full MC sample.
This comparison validates the procedure of generating toy-efficiencies, showing that the results obtained with them are compatible with the result obtained with the original efficiency.
Then, the method is applied to the data, after the unbinding of the signal region .%% , and these results are used to compute the systematic uncertainty.

An example of the fit result distributions, for $q^2$ bin~3, is shown in Figure~\ref{fig:BKG-bin3-toy}, for the fits on a cocktail-MC sample, and in Figure~\ref{fig:BKG-bin3}, for the fits on the data sample.

\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.9\textwidth]{Figures/MCstat/bin3_toy.pdf}
  \caption{Results of the fits on a cocktail-MC sample with toy-efficiency functions, for $q^2$ bin~3.
    On the left, the distributions of the $F_L$ (top), $P_1$ (middle), and $P_5'$ (bottom) parameter results are compared with the results from the fits with the original efficiency: on the same cocktail-MC sample (green line) and on the full MC sample (red line).
    On the right: the distributions of the {\tt HESSE} errors on the $F_L$(top), $P_1$ (middle), and $P_5'$ (bottom) parameters are shown.}
  \label{fig:BKG-bin3-toy}
\end{figure}

\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.9\textwidth]{Figures/MCstat/bin3.pdf}
  \caption{Results of the fits on the data sample with toy-efficiency functions, for $q^2$ bin~3.
    On the left, the distributions of the $F_L$ (top), $P_1$ (middle), and $P_5'$ (bottom) parameter results are shown.
    On the right: the distributions of the {\tt HESSE} errors on the $F_L$(top), $P_1$ (middle), and $P_5'$ (bottom) parameters are shown.}
  %% \caption{The average results with different toy-efficiency functions using one of the cocktail sample, in $q^2$ bin~3.
  %%   Top left: $F_L$ value, top right: $F_L$ fit error, middle right: $P_1$ value, middle right: $P_1$ fit error, bottom right: $P_5'$ value, middle right: $P_5'$ fit error.
  %%   The red lines indicate the fitting results on the full RECO MC.
  %%   The green lines indicate the fit results on the used toy sample using the original efficiency.}
  \label{fig:BKG-bin3}
\end{figure}

The spread of the fit results are summarised in Table~\ref{tab:lim.MCstat.toy}, for the fit on the cocktail-MC sample, and in Table~\ref{tab:lim.MCstat} for the fit to the data sample.
The latter are used as systematic uncertainty.

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Spread values of the toy-efficiency result distributions, computed fitting a data-like statistics cocktail-MC sample.
        \label{tab:lim.MCstat.toy}}
      \begin{tabular}{l|c|c|c|c}
        $q^2$ bin index  & $F_L$ & $P_1$ & $P_5'$ \\
        \hline
        $ 0 $ & $\pm0.0157$ & $\pm0.0720$ & $\pm0.0859$\\
        $ 1 $ & $\pm0.0110$ & $\pm0.1208$ & $\pm0.1070$\\
        $ 2 $ & $\pm0.0140$ & $\pm0.0726$ & $\pm0.0627$\\
        $ 3 $ & $\pm0.0047$ & $\pm0.0319$ & $\pm0.0264$\\
        $ 5 $ & $\pm0.0051$ & $\pm0.0170$ & $\pm0.0099$\\
        $ 7 $ & $\pm0.0043$ & $\pm0.0440$ & $\pm0.0384$\\
        $ 8 $ & $\pm0.0070$ & $\pm0.0790$ & $\pm0.0622$\\
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Spread values of the toy-efficiency result distributions, computed fitting real data.
        \label{tab:lim.MCstat}}
      \begin{tabular}{l|c|c|c|c}
        $q^2$ bin index  & $P_1$ & $P_5'$ \\
        \hline
        $ 0 $ & $\pm0.050$ & $\pm0.046$\\
        $ 1 $ & $\pm0.062$ & $\pm0.066$\\
        $ 2 $ & $\pm0.057$ & $\pm0.031$\\
        $ 3 $ & $\pm0.036$ & $\pm0.032$\\
        $ 5 $ & $\pm0.068$ & $\pm0.049$\\
        $ 7 $ & $\pm0.073$ & $\pm0.112$\\
        $ 8 $ & $\pm0.029$ & $\pm0.036$\\
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}

% \subsection{Kernel width}

% The kernel estimator was used with a constant width kernel width, chosen as a
% compromise to optimize the modelling of the efficiency shape without including
% spurious effect. The systematic associated with this choice is estimated by
% using, in the \pdf fit, a wider and a narrower kernel width, and comparing the results.


\section{Simulation mismodelling}
\label{sec:sys-mismodel}

The effects of the simulation mismodelling is measured through the capability of the analysis to retrieve the interesting observables in extremely favourable conditions, using pure-signal simulation with high statistics.

The fit results on generator-level MC sample are compared with the one on reconstruction-level MC sample, as described in Section~\ref{sec:fitval-reco}.
The discrepancies between them are considered as symmetric systematic uncertainties.

This systematic uncertainty also evaluates the impact of the non perfect symmetry of the efficiency with respect to the angular folding applied.
The folding procedure cancels some of the angular parameters only if applied at \pdf level.
The actual fit is performed at reconstruction level, taking into account the efficiency as a function of the angular variables.
The efficiency does not have the same exact symmetries as the \pdf, and this might cause the cancellation to be incomplete.
By comparing the results of the fit at generator level, when the cancellation is exact, with that at reconstruction level, when it is not, we evaluate the uncertainty related to the non-perfect cancellation.

The results are summarised for each $q^2$ bin in Table~\ref{tab:mis.modelling}.

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Systematic uncertainties: simulation mismodelling.
        \label{tab:mis.modelling}}
      \begin{tabular}{l|c|c|c|c}
        $q^2$ bin index  & $F_L$ & $P_1$ & $P_5'$ \\
        \hline
        $ 0 $ & $\pm0.011$ & $\pm0.005$ & $\pm0.023$\\
        $ 1 $ & $\pm0.001$ & $\pm0.005$ & $\pm0.013$\\
        $ 2 $ & $\pm0.009$ & $\pm0.001$ & $\pm0.015$\\
        $ 3 $ & $\pm0.012$ & $\pm0.006$ & $\pm0.012$\\
        $ 5 $ & $\pm0.006$ & $\pm0.001$ & $\pm0.021$\\
        $ 7 $ & $\pm0.008$ & $\pm0.033$ & $\pm0.010$\\
        $ 8 $ & $\pm0.004$ & $\pm0.006$ & $\pm0.014$\\
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}

\section{Efficiency shape}
\label{sec:effshape-syst}

The main validation of the correctness of the efficiency is performed by comparing the efficiency-corrected results for the control channels with the corresponding world-average values.
The efficiency as a function of the angular variables is checked by comparing the $F_\mathrm{L}$ measurements from the \BtoKstJpsi sample, composed of 165\,000 signal events.
The value of $F_\mathrm{L}$ obtained in this analysis is $0.537 \pm 0.002\stat$, compared with the world-average value of $0.571 \pm 0.007\,\text{(stat+syst)}$, indicating a discrepancy of $0.034$, which is used in the other $q^2$ bins and propagated to the $P_1$ and $P_5'$ parameters.
In each $q^2$ bin, a total of 200 values for the $F_L$ parameter is randomly generated from a Gaussian distribution, with mean the value of $F_L$ used in the fit to the data and with width the discrepancy to propagate, $0.034$.
Finally, the data sample is fitted fixing the $F_L$ parameter to each of these 200 values and the RMS of the fit results is taken as systematic uncertainty.
The results are summarised in Table~\ref{tab:eff.shape}.

For completeness the $F_\mathrm{L}$ variable is also measured with the \BtoKstpsip sample, obtaining a value $0.538 \pm 0.008\stat$ to be compared with the world-average value of $0.463^{+0.028}_{-0.040}\,\text{(stat+syst)}$.

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Systematic uncertainties: efficiency shape.
        \label{tab:eff.shape}}
      \begin{tabular}{l|c|c|c}
        $q^2$ bin index  & $P_1$ & $P_5'$  \\
        \hline
        $ 0 $ & $\pm0.017$ & $\pm0.005$ \\
        $ 1 $ & $\pm0.048$ & $\pm0.060$ \\
        $ 2 $ & $\pm0.093$ & $\pm0.065$ \\
        $ 3 $ & $\pm0.094$ & $\pm0.045$ \\
        $ 5 $ & $\pm0.083$ & $\pm0.059$ \\
        $ 7 $ & $\pm0.100$ & $\pm0.060$ \\
        $ 8 $ & $\pm0.068$ & $\pm0.041$ \\
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}

\paragraph{Cross check: branching fraction of $\PBz\to\PKst\Ppsi'$ and $\PBz\to\PKst\PJpsi$ }

A further test to validate the efficiency shape obtained from MC is to compare the branching fraction of the two control samples: $\PBz\to\PKst\Ppsi'$ and $\PBz\to\PKst\PJpsi$.

The ratio of the two BR can be computed as follow:
\begin{equation}\label{RBRatio}
  \frac{\mathcal{B}(\PBz\to\PKst\psi')}{\mathcal{B}(\PBz\to\PKst J/\psi)}
  = \frac{Y_{\Ppsi'}}{\epsilon_{\psi'}}\frac{\epsilon_{\PJpsi}}{Y_{J/\psi}}
  \frac{\mathcal{B}(J/\psi \to \Pgmp \Pgmm)}{\mathcal{B}(\psi' \to \Pgmp \Pgmm)}
\end{equation}
where $Y_{\psi'}$ and $\epsilon_{\psi'}$ are the yield and the efficiency for the $\psi'$ channel, and likewise for $Y_{\PJpsi}$ and $\epsilon_{J/\psi}$ for $J/\psi$ one.

The ratio of $\mathcal{B}$ for $J/\psi(\psi') \to \Pgmp \Pgmm$ is $7.54\pm0.86$ (PDG).
The value of the ratio is (PDG): $\frac{\mathcal{B}(\PBz\to\PKst\psi')}{\mathcal{B}(\PBz\to\PKst J/\psi)}=0.484 \pm 0.018 \textrm{\tiny{(stat)}} \pm 0.011 \textrm{\tiny{(syst)}} \pm 0.012 \textrm{\tiny{($R^{ee}_\psi$)}}$.

A first way to compute the ratio is to use directly the absolute efficiency for the two channels as obtained from MC.
The ratio we obtain with this method is $0.476\pm 0.008({\rm stat}) \pm 0.055({\rm R}_{\psi}^{\mu\mu})$, in very good agreement with PDG.

However, the computation above assumes that the angular shape of the control channel is correctly simulated in MC.
To take properly into account the real signal and efficiency shape, we repeated the same computation using as efficiency $\varepsilon_{J/\psi/\Ppsi'}=\int_{phase~space}S(\vec{x};\vec{p})\times\varepsilon(\vec{x})d\vec{x}$, where $S(\vec{x};\vec{p})$ is the signal \pdf, $\vec{p}$ is the set of angular parameter we got from the fit on the data on each control region, and $\varepsilon(\vec{x})$ is the efficiency for each region as a function of angular variable.
The result of this more detailed computation is: $0.480\pm 0.008({\rm stat}) \pm 0.055({\rm R}_{\psi}^{\mu\mu})$, again in very good agreement with PDG.

The same ratio can be computed using only right tag events, only wrong tag events, or both: in all the cases the agreement is very good.

\section{Fitting Bias}
\label{sec:fitbias-syst}

The fitting procedure itself could generate biases in the results, in addition to the uncertainties from the fitting components (efficiency, background shape, \pdf, etc) described above.
The fitting procedure uncertainties thus arise from the possible biases from the fitting methods and procedures.

We estimate this contribution from the fit results of the data-like simulated samples, which are described in Section~\ref{sec:Cocktail-MC-full}.

To evaluate the fitting bias, we compare the average result of the fits to cocktail MC samples and the fitting result of full statistics MC sample.
These differences are used as an estimation of this systematic uncertainty.
The results are summarised in Table~\ref{tab:fit bias}.

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Systematic uncertainties: fitting bias.
        \label{tab:fit bias}}
      \begin{tabular}{l|c|c|c}
        $q^2$ bin index  & $P_1$ & $P_5'$  \\
        \hline
        $0$ & $\pm0.005$ & $\pm0.040$ \\
        $1$ & $\pm0.007$ & $\pm0.010$ \\
        $2$ & $\pm0.019$ & $\pm0.119$ \\
        $3$ & $\pm0.019$ & $\pm0.106$ \\
        $5$ & $\pm0.041$ & $\pm0.052$ \\
        $7$ & $\pm0.071$ & $\pm0.048$ \\
        $8$ & $\pm0.078$ & $\pm0.031$ \\
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}


\section{Wrong CP assignment}
\label{sec:sys-mistag}

% This source of uncertainties will be evaluated from the data after the
% unblinding of the analysis, following what has been done in
% BPH-13-010. The method is described in the following steps:

% \begin{itemize}
%     \item measure $B^0$ width with $K^{*0}(K\pi)J/\psi(\mu\mu)$
%       control sample and compare the data/MC difference, as a cross-check.
%     \item measure mistag ratio with $K^{*0}(K\pi)J/\psi(\mu\mu)$
%       control sample and compare the data/MC difference, as a cross-check.
%     \item Finally propagate the uncertainty of the mistag fraction to
%       the results. This will be done by fitting data N times with
%       mis-tag ratio randomly generated according to gaussian centered
%       at nominal value and with $\sigma$ from the previous two
%       checks.
% \end{itemize}

% \subsection{Mistag fraction}
% \label{sec:mistag}
The error on mistag fraction has been estimated using the control channel \BtoKstJpsi, in $q^2$ bin~4.
A full fit on this channel has been performed, leaving also the mistag fraction free to float.
This fit is possible on the control channel thanks to its large statistics, and the result has been compared with the mistag fraction estimated from MC sample.
The difference between these values is 0.008 and, compared with the statistical uncertainty of the MC estimate in this bin, $\sigma\lesssim0.002$, it results to be the dominant uncertainty related to the mistag fraction.

To assess the propagation of this systematic effect to the physical parameter of the final fit on data, a set of fits has been performed, using as free parameters $A_s^5$, $P_1$, $P_5'$, the signal and background yields, and using a fixed mistag fraction.
A set of 10 different values of mistag fractions has been used, randomly generated with Gaussian distribution around the mistag fraction estimated from MC for each $q^2$ bin, and with $\sigma$ equal to the difference of 0.008 computed on the control channel.
For each $q^2$ bin, the RMS of the results of the 10 fits is used as systematic uncertainty for the fitted angular parameters, as summarised in Table~\ref{tab:Mistagfraction}.

\begin{table*}[!htb]
  \begin {center}
    \caption{Systematic uncertainties: mistag fraction.\label{tab:Mistagfraction}}
    \begin{tabular}{l|c|c|c}
      $q^2$ bin index & $A_s^5$  & $P_1$ & $P_5'$  \\
      \hline
      \hline
      0  & 0.000035 & 0.014  &  0.013 \\
      1  & 0.000014 & 0.022  &  0.015 \\
      2  & 0.0050   & 0.016  &  0.014 \\ 
      3  & 0.0025   & 0.0084 &  0.0058\\ 
      5  & 0.0037   & 0.043  &  0.032  \\ 
      7  & 0.015    & 0.11   &  0.066 \\
      8  & 0.0050   & 0.025  &  0.016 \\
    \end{tabular}

  \end{center}
\end{table*}

\section{Background distributions}
\label{sec:sys-bkg}

The parameters of the background component in the \pdf are estimated on the mass sidebands and kept fixed in the fit to the full mass range, as described in Section~\ref{sec:backg}.
Due to the limited statistics of the mass sideband samples, the background parameters have a not-negligible uncertainty, that should be propagated to the analysis results as systematic uncertainty.

The errors of the background \pdf parameters are evaluated by the {\tt HESSE} algorithm running during the fit to the mass sidebands.
A set of 200 background toy-functions are then generated by using the same polynomial expression described in Section~\ref{sec:backg}, and randomly generating the value of each parameter from a Gaussian distribution, with mean and width equal to the {\tt HESSE} results of the sideband fit.

To propagate this uncertainty to the signal parameters, the fit to the data is run 200 times, by using the new background toy-functions. The widths of the result distributions are used as systematic uncertainties.

An example of the distributions of the toy-background fit results, for $q^2$ bin~2, is shown in Figure~\ref{fig:BKG-bin2}.

\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.8\textwidth]{Figures/BKG/bin2.pdf}
  \caption{The results of the fits on data performed with background toy-functions, for the $q^2$ bin~2.
    The distributions of $P_1$ (top left), $P_5'$ (top right), signal yield (bottom left), and background yield (bottom right) are shown.}
  \label{fig:BKG-bin2}
\end{figure}

The resulting uncertainties are summarised in the Table~\ref{tab:bkg. shape}.

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Systematic uncertainties: background shape.
        \label{tab:bkg. shape}}
      \begin{tabular}{l|c|c|c}
        $q^2$ bin index & $P_1$ & $P_5'$ \\
        \hline
        $0$ & $\pm0.013$ & $\pm0.010$ \\
        $1$ & $\pm0.031$ & $\pm0.024$ \\
        $2$ & $\pm0.046$ & $\pm0.030$ \\
        $3$ & $\pm0.022$ & $\pm0.013$ \\
        $5$ & $\pm0.070$ & $\pm0.049$ \\
        $7$ & $\pm0.069$ & $\pm0.051$ \\
        $8$ & $\pm0.012$ & $\pm0.015$ \\
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}

\paragraph{Partially reconstructed background}
\label{sec:partRecoBkg}

%% The low-mass sideband might be affected by background events that have a different origin with respect to the combinatorial background that characterizes the signal region, e.g. partially reconstructed multibody \PB decays.
%% We address this possible background contamination in Section~\ref{sec:Systematics}

%%%%%%%%%%%%%%%%%%%%%%%%%%5 Note appendix
Since the lower sideband in the candidate $\PBz$ mass has a value range starting at about $5 \GeV$, it can contain a contamination from partially reconstructed events, i.e. events in which a $\PBz$ meson decays in a final state with more than four detectable particles and the candidate $\PBz$ is built using only four of them.
The kinematic end-point for this kind of events is between $5.1\GeV$ and $5.15\GeV$.
Since the angular distribution of these background events is expected to be different with respect to the distribution of the combinatorial background, a contamination of the lower sideband would bias the fit of the background parameters of the \pdf, estimated in the first step of the fit, according to the fit sequence described in Section~\ref{sec:fitseq}.
Then, the biased background \pdf is used in the second step of the fit, even though under the resonance there is no contamination, and the fitted values of $P_1$ and $P^\prime_5$ can be affected.

In order to check whether an eventual contamination has introduced a significant bias in the fitted values of $P_1$ and $P^\prime_5$, the two steps of the fit are repeated, but with the range of the low-mass sideband starting at about $5.1 \GeV$ (exactly $1 \GeV$ more narrow than the original sideband), and the results of the $P_1$ and $P^\prime_5$ parameters are compared with the original fit.
A natural difference in these results can derive from the statistical fluctuation due to the use of a sub-sample of the original dataset.
For this reason, the differences observed in this test are compared with the values of the \textit{Background Distribution} systematic uncertainty.

The results of the fits with the reduced sideband are reported in Table~\ref{tab:red-sideband}, together with their absolute difference with respect to the original results.
The values of the \textit{Background Distribution} systematic uncertainty are reported in this table as well.

In the table are highlighted the differences that exceed twice the value of the systematic uncertainty.
Globally, the differences are considered compatible with the systematics uncertainty.
In the few bins with a larger difference, the results of the fit with reduced sidebands are affected by the very low statistics left in the sideband region.
The worst case is bin 7, where the sideband reduction remove about 75\% of the background events.

\begin{table*}[htb]
  \caption{Results of the fits with the reduced sideband and their absolute difference with respect to the results with the full sideband, as described in Section~\ref{sec:partRecoBkg}.
    The values of the \textit{Background Distribution} systematics, as described in Section~\ref{sec:sys-bkg}, are reported here for comparison sake.\label{tab:red-sideband}}
          {\small
            \begin{center}
              \begin{tabular}{l|ccc|ccc}
                $q^2$ bin & \multicolumn{3}{c}{$P_1$} & \multicolumn{3}{c}{$P'_5$} \\
                index & result & difference & syst & result & difference & syst \\
                \hline
                0 &  0.124 & 0.005 & 0.013 &  0.077 &*0.024*& 0.010 \\
                1 & -0.675 & 0.010 & 0.031 & -0.541 & 0.026 & 0.024 \\
                2 &  0.505 & 0.028 & 0.046 & -0.888 &*0.069*& 0.030 \\
                3 & -0.457 & 0.013 & 0.022 & -0.689 &*0.046*& 0.013 \\
                5 & -0.490 & 0.041 & 0.070 & -0.714 & 0.024 & 0.049 \\
                7 & -0.502 &*0.173*& 0.069 & -0.705 & 0.069 & 0.051 \\
                8 & -0.520 & 0.013 & 0.012 & -0.565 & 0.006 & 0.015 \\
              \end{tabular}
            \end{center}
          }
\end{table*}

%%%%%%%%%%%%%%%%%%55


\section{Mass Distribution}
\label{sec:sys-mass distribution}

% Some components of the p.d.f are derived from simulations. The
% simulation might not describe the behaviour of the real detector with
% enough accuracy which may affect the fitting results.  

%% The mass distributions for the correctly tagged and mistagged events are each described by the sum of two Gaussian functions, with a common mean for all four Gaussian functions.
%% The mean value is obtained from the fit to the data, while the other parameters (four $\sigma$ and two ratios) are obtained from fits to MC-simulated events.

The parameters of the mass shape in the signal component of the \pdf are estimated through a fit to the MC mass distribution and kept fixed in the data fit, as described in Section~\ref{sec:fitseq}.
To evaluate the bias due to mis-modelling of the MC description of the mass shapes, and propagate it to the analysis results as a systematics, the control channels are used.
Thanks to the high-statistics of these samples, it is possible to perform a fit with some mass parameters free to float.
The angular parameters are measured on both control channels, at first with signal mass shape for right-tagged events free to float, and then with signal mass shape for mis-tagged events free to float.
The difference of the angular parameter values obtained from these fits, with respect to the results with the standard fit sequence, are calculated.
For each parameter, the largest of these differences is used as systematic uncertainty for all the $q^2$ bins.

The maximum difference of $P1$ is 0.012, of $P5'$ is 0.019.

\section{Uncertainty from fixed \pdf parameters}
\label{sec:sys-fixedparm}

Fixing three of the six angular parameters in the fit could have an effect of modifying the statistical uncertainties for the fitted parameters.
This is true, in general, whenever there is a correlation between any fixed parameter and a free one.
Since this effect could lead to an underestimation of the statistical error, a specific systematic uncertainty has been created to compensate this effect.
For each measured parameter we define a \textit{scale factor} as the correction factor, greater than or equal to one, that should be applied to the underestimated statistical error to compensate this effect. 

%% Firstly, this scale factor is computed.

Since it is not possible to fit the data with the $F_L$, $F_s$, $A_s$ parameters free to float, this scale factor is computed on pseudo-experiments with one hundred times the statistics of the data sample.
Ten pseudo-experiments are used, for each $q^2$ bin, and the average of the ten resulting scale factors is used to compute the uncertainty.
The same procedure described in Sec.~\ref{sec:statUncert} to fit a pseudo-experiment for the Feldman-Cousins (FC) method is used here to fit each high-statistics pseudo-experiment.
The only difference is that the number of points where the 2D-likelihood is probed here is around one hundred, in order to guarantee a more robust result.
This fitting procedure is applied twice, both fixing the $F_L$, $F_s$, $A_s$ parameters and leaving them free to float.
Then, two scale factors are defined, one for $P_1$ and one for $P'_5$, as the ratio between the confidence intervals obtained with the two fits (fit with floating parameters over fit with fixed parameters).
Note that here the {\tt custom MINOS} method, defined in Sec.~\ref{sec:statUncert}, is used to define the parameters' confidence interval.

Finally, each scale-factor average was used to compute the systematic uncertainty.
If it is smaller than one, it means that the estimated effect of freeing the parameters is to reduce the statistical error.
In this case, no correction is applied.
Otherwise, if it is larger than one, we define the uncertainty value as the one that, if added in quadrature with the statistical error, would increase it by this estimated factor.
Thus, it is
\begin{equation} \label{eq:fix.syst.def}
S = \sigma \sqrt{f^2-1}
\end{equation}
where $\sigma$ is the statistical error and $f$ is the scale-factor average.

%% A test to check whether the \textit{scale factors} depend on the statistics of the pseudo-experiments used is described in Section~\ref{sec:app-fixSyst.test}.

The scale-factor averages and the systematic uncertainty values are reported in table~\ref{tab:systFix}.

\begin{table*}[!htb]
  \caption{Scale-factor average values and systematic uncertainties computed to compensate the statistical error reduction introduced fixing some PDF parameters\label{tab:systFix}}
  \begin{center}
    \begin{tabular}{l|cc|cc}
      $q^2$ bin index & SF($P_1$)  & $P_1$  & SF($P'_5$) & $P'_5$ \\
      \hline
      0 & 1.014 & 0.077 & 1.003 & 0.025  \\
      1 & 1.116 & 0.211 & 1.099 & 0.148  \\
      2 & 1.113 & 0.139 & 1.385 & 0.206  \\
      3 & 1.082 & 0.103 & 1.028 & 0.041  \\
      5 & 1.048 & 0.053 & 1.143 & 0.069  \\
      7 & 0.982 & 0.000 & 1.090 & 0.072  \\
      8 & 1.091 & 0.083 & 0.989 & 0.000  \\
    \end{tabular}
  \end{center}
\end{table*}

To verify that the procedure of fixing those parameters in the fit is only affecting the statistical uncertainty, but it is not introducing any significant bias in the best-fit values, we compared the results of the fits to the sets of pseudo-experiments, both with floating and fixed parameters, with the input values used to generate them.
An example of the plots used for this comparison, for $q^2$ bin~2, is shown in Figure~\ref{fig:fixSyst2}.
No significant bias are present.

%% \begin{figure}[!hbt]
%%   \centering
%%   \includegraphics[width=0.7\textwidth]{Figures/FixSyst/fixSysPlot_b0.pdf}
%%   \caption{Distributions of the best-fit values of the fits performed, in $q^2$ bin 0, on the high-statistics pseudo-experiments used to compute the systematic uncertainty for the fixed parameters, as described in Section~\ref{sec:sys-fixedparm}. The blue (red) histogram is the distribution of the results of the fit with fixed (floating) $F_L$, $F_s$, $A_s$ parameters. The black line marks the input value used to generate the pseudo-experiments. Top: results for $P_1$. Bottom: results for $P'_5$. }
%%   \label{fig:fixSyst0}
%% \end{figure}

%% \begin{figure}[!hbt]
%%   \centering
%%   \includegraphics[width=0.7\textwidth]{Figures/FixSyst/fixSysPlot_b1.pdf}
%%   \caption{Distributions of the best-fit values of the fits performed, in $q^2$ bin 1, on the high-statistics pseudo-experiments used to compute the systematic uncertainty for the fixed parameters, as described in Section~\ref{sec:sys-fixedparm}. The blue (red) histogram is the distribution of the results of the fit with fixed (floating) $F_L$, $F_s$, $A_s$ parameters. The black line marks the input value used to generate the pseudo-experiments. Top: results for $P_1$. Bottom: results for $P'_5$. }
%%   \label{fig:fixSyst1}
%% \end{figure}

\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.7\textwidth]{Figures/FixSyst/fixSysPlot_b2.pdf}
  \caption{Distributions of the best-fit values of the fits performed, in $q^2$ bin 2, on the high-statistics pseudo-experiments used to compute the systematic uncertainty for the fixed parameters, as described in Section~\ref{sec:sys-fixedparm}. The blue (red) histogram is the distribution of the results of the fit with fixed (floating) $F_L$, $F_s$, $A_s$ parameters. The black line marks the input value used to generate the pseudo-experiments. Top: results for $P_1$. Bottom: results for $P'_5$. }
  \label{fig:fixSyst2}
\end{figure}

%% \begin{figure}[!hbt]
%%   \centering
%%   \includegraphics[width=0.7\textwidth]{Figures/FixSyst/fixSysPlot_b3.pdf}
%%   \caption{Distributions of the best-fit values of the fits performed, in $q^2$ bin 3, on the high-statistics pseudo-experiments used to compute the systematic uncertainty for the fixed parameters, as described in Section~\ref{sec:sys-fixedparm}. The blue (red) histogram is the distribution of the results of the fit with fixed (floating) $F_L$, $F_s$, $A_s$ parameters. The black line marks the input value used to generate the pseudo-experiments. Top: results for $P_1$. Bottom: results for $P'_5$. }
%%   \label{fig:fixSyst3}
%% \end{figure}

%% \begin{figure}[!hbt]
%%   \centering
%%   \includegraphics[width=0.7\textwidth]{Figures/FixSyst/fixSysPlot_b5.pdf}
%%   \caption{Distributions of the best-fit values of the fits performed, in $q^2$ bin 5, on the high-statistics pseudo-experiments used to compute the systematic uncertainty for the fixed parameters, as described in Section~\ref{sec:sys-fixedparm}. The blue (red) histogram is the distribution of the results of the fit with fixed (floating) $F_L$, $F_s$, $A_s$ parameters. The black line marks the input value used to generate the pseudo-experiments. Top: results for $P_1$. Bottom: results for $P'_5$. }
%%   \label{fig:fixSyst5}
%% \end{figure}

%% \begin{figure}[!hbt]
%%   \centering
%%   \includegraphics[width=0.7\textwidth]{Figures/FixSyst/fixSysPlot_b7.pdf}
%%   \caption{Distributions of the best-fit values of the fits performed, in $q^2$ bin 7, on the high-statistics pseudo-experiments used to compute the systematic uncertainty for the fixed parameters, as described in Section~\ref{sec:sys-fixedparm}. The blue (red) histogram is the distribution of the results of the fit with fixed (floating) $F_L$, $F_s$, $A_s$ parameters. The black line marks the input value used to generate the pseudo-experiments. Top: results for $P_1$. Bottom: results for $P'_5$. }
%%   \label{fig:fixSyst7}
%% \end{figure}

%% \begin{figure}[!hbt]
%%   \centering
%%   \includegraphics[width=0.7\textwidth]{Figures/FixSyst/fixSysPlot_b8.pdf}
%%   \caption{Distributions of the best-fit values of the fits performed, in $q^2$ bin 8, on the high-statistics pseudo-experiments used to compute the systematic uncertainty for the fixed parameters, as described in Section~\ref{sec:sys-fixedparm}. The blue (red) histogram is the distribution of the results of the fit with fixed (floating) $F_L$, $F_s$, $A_s$ parameters. The black line marks the input value used to generate the pseudo-experiments. Top: results for $P_1$. Bottom: results for $P'_5$. }
%%   \label{fig:fixSyst8}
%% \end{figure}


%%%%%%%%%%%%%%%%%%%%555

\clearpage


\section{Angular Resolution}
\label{sec:sys-angres}

This systematic uncertainty is due to the limited detector resolution on angular distributions.
To evaluate its impact, the likelihood fit has been performed on the full simulated dataset on reconstructed quantities after all selections, considering only the right-tagged candidates.
The same fit has been performed on the same sample, but using the generated angular quantities in place of the reconstructed ones.
%% Each fit has been repeated for a set of 100 initial values, choosen randomly in the allowed phase space, and only the fully converged fit has been considered to compare the results, both for gen and for reco-level angles.
The difference between the two results, shown in table~\ref{tab:systReso}, is used as a systematic uncertainty for each $q^2$ bin.

\begin{table*}[!htb]
  \caption{Difference on the target physics observables ($F_L$, $P_1$, and $P'_5$) when obtained via a fit on reconstructed and generated angular distributions after all selection, performed on full MC sample. $\Delta{x}=|x_{RECO} - x_{GEN}|$\label{tab:systReso}}
  \begin{center}
    \begin{tabular}{l|ccc}
      $q^2$ bin index & $\Delta{F_L}$  & $\Delta{P_1}$  & $\Delta{P'_5}$ \\
      \hline
      0  & -3.98\e{-4}  & -1.50\e{-3} &  1.05\e{-4}   \\
      1  & -7.83\e{-4}  & -3.30\e{-3} &  1.03\e{-3}  \\
      2  & -8.83\e{-3}  & -6.88\e{-3} &  1.33\e{-3}   \\
      3  & -4.94\e{-4}  & -7.38\e{-3} &  8.10\e{-4}   \\
      5  &  1.16\e{-3}  & -1.51\e{-2} &  2.36\e{-3}   \\
      7  &  2.90\e{-4}  & -7.26\e{-3} & -8.28\e{-3}   \\
      8  & -1.93\e{-3}  & -6.81\e{-2} &  1.23\e{-2}   \\
    \end{tabular}
  \end{center}
\end{table*}

\clearpage

\section{Feed-through background}
\label{sec:feedthr}

The $q^2$ bins just below and above the resonance regions may be contaminated by $B^0 \to {\rm J/}\psi K^{*0}$ and $B^0 \to \psi' K^{*0}$ feed-through events that are not removed by the selection criteria.
The potential uncertainties due to this contamination have been evaluated.

The distribution of residual feed-through events are described by a special \pdf.
The distributions in $q^2$ bins 3 and 5 are evaluated from $B^0 \to {\rm J/}\psi K^{*0}$ simulation, as shown in Figure~\ref{fig:feed-J-bin3} and Figure~\ref{fig:feed-J-bin5}.
Similarly, the distributions in $q^2$ bin~5 are evaluated from $B^0 \to \psi' K^{*0}$ simulated sample


\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.7\textwidth]{Figures/Syst/Feed-through/JPsi-bin3.pdf}
  \caption{Distributions of the feed-through events of the \BtoKstJpsi MC sample and the projections of the \pdf used to describe it, for $q^2$ bin~3.
  }
  \label{fig:feed-J-bin3}
\end{figure}

\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.7\textwidth]{Figures/Syst/Feed-through/JPsi-bin5.pdf}
  \caption{Distributions of the feed-through events of the \BtoKstJpsi MC sample and the projections of the \pdf used to describe it, for $q^2$ bin~5.
  }
  \label{fig:feed-J-bin5}
\end{figure} 

Data are then fitted with this additional component of feed through backgrounds, as shown in Fig~\ref{fig:feed-t-bin3} and Fig~\ref{fig:feed-t-bin5}.

\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.7\textwidth]{Figures/Syst/Feed-through/TotalPDFq2Bin_3_Canv0.pdf}
  \caption{Distributions of the data events, and the projections of the \pdf with the additional component for feed-through background, for $q^2$ bin~3.}
  \label{fig:feed-t-bin3}
\end{figure}

\begin{figure}[!hbt]
  \centering
  \includegraphics[width=0.7\textwidth]{Figures/Syst/Feed-through/TotalPDFq2Bin_5_Canv0.pdf}
  \caption{Distributions of the data events, and the projections of the \pdf with the additional component for feed-through background, for $q^2$ bin~5.}
  \label{fig:feed-t-bin5}
\end{figure} 

Discrepancies on the measured observables are then conservatively considered as symmetric systematic uncertainties.
There are two results for $q^2$ bin~5, one from $B^0 \to {\rm J/}\psi K^{*0}$ and the other from $B^0 \to \psi' K^{*0}$.
Then we choose the bigger one as the systematic uncertainty.
The result are in the Table~\ref{tab:feed-through}.

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Systematic uncertainties from the feed through backgrounds.
        \label{tab:feed-through}}
      \begin{tabular}{l|c|c|c}
        $q^2$ bin index & $P_1$ & $P_5'$ \\
        \hline
        $3$ & $\pm 0.004$ & $\pm 0.012$ \\
        $5$ & $\pm 0.012$ & $\pm 0.020$ \\
        $7$ & $\pm 0.011$ & $\pm 0.024$ \\
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}

\section{Bivariate Guassian fit range}\label{sec:bestFit}

As described in Section~\ref{sec:fitseq}, the procedure to get the best fit from the data is to discretise the $P_1,P'_5$ space, and maximise the likelihood as a function of nuisance parameters at fixed values of $P_1,P'_5$.
So we have a scan of the likelihood in the $P_1$, $P'_5$ plane.
Finally, the likelihood distribution is fitted with a bivariate normal distribution.

In order to check the stability of the fit, as well as any possible systematics due to the procedure, the angular parameters are evaluated varying the fit range.
The range of the fit is defined as $\pm1\sigma$ (as computed by the FC procedure described in Section~\ref{sec:statUncert}), multiplied by a scale factor (in the range $[0.1,2]$), around the centre defined as the value of $P_1$ or $P'_5$, among the points of the grid defined in Section~\ref{sec:fitseq}, where the likelihood has an absolute maximum.
%% So, for instance, a scale factor of $1.5$ means that the fit range will be $[P_1-1.5\sigma,P_1+1.5\sigma]$, and so on.

An example of the results of these scans is shown in Figure~\ref{fig:gausFitRange}, for $q^2$ bin~3.
To give an element of comparison, the $y$-axis range in the plots of the results is set equal to the confidence interval, as computed by the FC procedure described in Section~\ref{sec:statUncert}. 
%% the vertical axis range in these plots is chosen to be $\pm1\sigma$ for that specific bin.
The difference between the value of $P_1$ and $P'_5$ from the absolute maximum and the normal fit is small, when compared with statistical uncertainties and to the \textit{fit bias} uncertainty.
Also the trend with respect to the fit range is small.

A quantitative difference has been extracted by comparing the value of the position of the absolute maximum with that of a bivariate Gaussian fit, via linear fit in the scale factor range $[0.4,1.6]$, evaluated for scale factor equal to 1.
The differences are reported in table~\ref{tab:rangeGausFit}.

Since these differences have the same nature of the \textit{fit bias} uncertainty, but are smaller than it, no specific systematic uncertainty has been introduced for them. 

\begin{figure}
  \centering
  %% \includegraphics[width=0.45\textwidth]{Figures/FC/testGausFitRange_bin0.pdf}
  %% \includegraphics[width=0.45\textwidth]{Figures/FC/testGausFitRange_bin1.pdf}
  %% \includegraphics[width=0.45\textwidth]{Figures/FC/testGausFitRange_bin2.pdf}
  \includegraphics[width=0.8\textwidth]{Figures/FC/testGausFitRange_bin3.pdf}
  %% \includegraphics[width=0.45\textwidth]{Figures/FC/testGausFitRange_bin5.pdf}
  %% \includegraphics[width=0.45\textwidth]{Figures/FC/testGausFitRange_bin7.pdf}
  %% \includegraphics[width=0.45\textwidth]{Figures/FC/testGausFitRange_bin8.pdf}
  \caption{Comparison between the position of the absolute maximum of the likelihood (green line) and the results of the bivariate Gaussian fit, as a function of the fit range (black dots), for the $P_1$ (left) and $P_5'$ (right) parameters, in $q^2$ bin~3.
  }
  \label{fig:gausFitRange}
\end{figure}

\begin{table*}[!htb]
  \begin {center}
    \begin{small}
      \caption{Systematic uncertainties: bias from bivariate Gaussian fit to the likelihood.
        \label{tab:rangeGausFit}}
      \begin{tabular}{l|cc}
        \hline
        $q^2$ bin index   & $P_1$ & $P_5'$ \\
        \hline
        $ 0 $    &   $\pm0.012$ & $\pm0.009 $   \\
        $ 1 $    &   $\pm0.005$ & $\pm0.005 $   \\
        $ 2 $    &   $\pm0.002$ & $\pm0.007 $   \\
        $ 3 $    &   $\pm0.016$ & $\pm0.0002$   \\
        $ 5 $    &   $\pm0.009$ & $\pm0.020 $   \\
        $ 7 $    &   $\pm0.010$ & $\pm0.012 $   \\
        $ 8 $    &   $\pm0.004$ & $\pm0.001 $   \\
        \hline
      \end{tabular}
    \end{small}
  \end{center}
\end{table*}

\section{Total Systematic Uncertainties}
\label{sec:sys-total}

The summary of all systematic uncertainties are shown in Table~\ref{tab:systematics}.

%% \begin{table*}[htbp!]
%%   \centering
%%   \caption{\label{tab:systematics} Systematic uncertainty contributions for the measurements of $P1$ and $P5'$.
%%     The total uncertainty in each $q^2$ bin is obtained by adding each contribution in quadrature.
%%     For each item, the range indicates the variation of the uncertainty in the signal $q^2$ bins.}
%%   \begin{tabular}{l|cccc}
%%     Systematic uncertainty & $P_1 (10^{-3})$ & $P_5' (10^{-3})$ \\[1pt]
%%     \hline \\[-2ex]
%%     Simulation mismodelling               &  1--33  &  10--23  \\[1pt]
%%     fitting bias                          &  5--78  &  10--119 \\[1pt]
%%     MC statistical uncertainty            & 29--73  &  31--112 \\[1pt]
%%     Efficiency                            & 17--100 &   5--65  \\[1pt]
%%     $\textrm{K}\pi$ mistagging                   &  8--110 &   6--66  \\[1pt]
%%     Background distribution               & 12--70  &  10--51  \\[1pt]
%%     Mass distribution                     &     12  &      19  \\[1pt]
%%     Feed-through background               &  4--12  &   3--24  \\[1pt]
%%     $F_L,F_S,A_S$ uncertainty propagation &  0--126 &   0--200 \\[1pt]
%%     Angular resolution                    &  2--68  & 0.2--12  \\[1pt]
%%     Bivariate fit range                   &  2--16  & 0.2--20  \\[1pt]
%%     \hline
%%     Total systematic uncertainty          & 70--220 &  70--230 \\[1pt]
%%   \end{tabular}
%% \end{table*}

\begin{table*}[htbp]
  \centering
  \caption{\label{tab:systematics} Systematic uncertainty contributions for the measurements of $P1$ and $P5'$.
    The total uncertainty in each $q^2$ bin is obtained by adding each contribution in quadrature.
    For each item, the range indicates the variation of the uncertainty in the signal $q^2$ bins.}
  %% \caption{\label{tab:systematics}
  %%   Systematic uncertainties in $P_1$ and $P_5'$. For each source, the range indicates the variation over the bins in $q^2$.}     
  \begin{tabular}{lcc}
    Source & $P_1 (\times 10^{-3})$ & $P_5' (\times 10^{-3})$ \\[1pt]
    \hline \\[-2ex]
    Simulation mismodeling       &   1--33   &  10--23  \\[1pt]
    Fit bias                     &   5--78   &  10--120 \\[1pt]
    Finite size of simulated samples  &  29--73   &  31--110 \\[1pt]
    Efficiency                   &  17--100  &   5--65  \\[1pt]
    $\textrm{K}\pi$ mistagging   &   8--110  &   6--66  \\[1pt]
    Background distribution      &  12--70   &  10--51  \\[1pt]
    %Partially reconstruced \PBz  &   ?--?    &   ?--?   \\[1pt]
    Mass distribution            &      12   &      19  \\[1pt]
    Feed-through background      &   4--12   &   3--24  \\[1pt]
    $F_\mathrm{L}$, $F_\mathrm{S}$, $A_\mathrm{S}$ uncertainty propagation & 0--210 & 0--210 \\[1pt]
    Angular resolution           &   2--68   & 0.1--12  \\[1pt]
    \hline
    Total                        & 100--230  &  70--250 \\[1pt]
  \end{tabular}
\end{table*}
